{% extends 'core/admin/admin_base.html' %}

{% block title %}{{ titulo }}{% endblock %}

{% block page_title %}{{ titulo }}{% endblock %}

{% block content %}
<div class="row justify-content-center"> 
    <div class="col-lg-8"> 
        <div class="card table-card">
            <div class="card-header bg-white border-0 py-3">
                <h5 class="card-title mb-0">
                    {% if producto %}
                        <i class="fas fa-pencil-alt text-primary me-2"></i>Editar Producto
                    {% else %}
                        <i class="fas fa-plus-circle text-primary me-2"></i>Crear Nuevo Producto
                    {% endif %}
                </h5>
            </div>
            <div class="card-body p-4">
                <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    {# Iteramos sobre los campos del formulario para aplicar clases de Bootstrap #}
                    {% for field in form %}
                        <div class="mb-3">
                            {# Label con clase form-label #}
                            <label for="{{ field.id_for_label }}" class="form-label fw-semibold">{{ field.label }}</label>

                            {# Input/Select/Textarea con clase form-control/form-select/form-check-input #}
                            {% if field.field.widget.input_type == 'checkbox' %}
                                <div class="form-check form-switch">
                                    <input type="{{ field.field.widget.input_type }}"
                                           class="form-check-input"
                                           name="{{ field.name }}"
                                           id="{{ field.id_for_label }}"
                                           {% if field.value %}checked{% endif %}>
                                    {# No mostramos label aquí para switch, Bootstrap lo maneja diferente #}
                                </div>
                            {% elif field.field.widget.input_type == 'file' %}
                                {{ field }} {# El widget FileInput ya es estilizado por Bootstrap #}
                                {% if field.value and producto.imagen %}
                                    <div class="mt-2">
                                        <small>Imagen actual:</small><br>
                                        <img src="{{ producto.imagen.url }}" alt="Imagen actual" style="max-height: 100px; border-radius: 8px;">
                                    </div>
                                {% endif %}
                            {% elif field.field.widget.input_type == 'select' %}
                                {# Renderizar correctamente el select con sus opciones #}
                                <select class="form-select" name="{{ field.name }}" id="{{ field.id_for_label }}">
                                    <option value="">Selecciona una categoría</option>
                                    {% for choice_value, choice_label in field.field.choices %}
                                        <option value="{{ choice_value }}" {% if field.value == choice_value or field.value|stringformat:"s" == choice_value|stringformat:"s" %}selected{% endif %}>
                                            {{ choice_label }}
                                        </option>
                                    {% endfor %}
                                </select>
                            {% elif field.field.widget.input_type == 'textarea' %}
                                <textarea class="form-control"
                                          name="{{ field.name }}"
                                          id="{{ field.id_for_label }}"
                                          rows="3"
                                          placeholder="{{ field.label }}">{{ field.value|default:'' }}</textarea>
                            {% else %}
                                <input type="{{ field.field.widget.input_type }}"
                                       class="form-control"
                                       name="{{ field.name }}"
                                       id="{{ field.id_for_label }}"
                                       value="{{ field.value|default:'' }}"
                                       {% if field.field.widget.input_type == 'number' %} step="any" {% endif %} {# Permite decimales #}
                                       placeholder="{{ field.label }}">
                            {% endif %}


                            {# Ayuda y Errores #}
                            {% if field.help_text %}
                                <div class="form-text">{{ field.help_text }}</div>
                            {% endif %}
                            {% for error in field.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        </div>
                    {% endfor %}

                    {# Botones #}
                    <div class="d-flex justify-content-between mt-4">
                        <a href="{% url 'admin_productos_lista' %}" class="btn btn-secondary">
                            <i class="fas fa-times me-2"></i>Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Guardar Producto
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}